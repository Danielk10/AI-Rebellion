# GUÍA COMPLETA DE IMPLEMENTACIÓN - Límites del Mundo vs Límites de Pantalla

## PROBLEMA ORIGINAL

Tu sistema actual limitaba al jugador usando las constantes de pantalla:

```java
if (x >= (Juego.ANCHO_PANTALLA - 32) - ancho) {
    x = (Juego.ANCHO_PANTALLA - 32) - ancho;
}
if (x <= 32) {
    x = 32;
}
// ... más límites con ALTO_PANTALLA
```

**Problema**: El jugador quedaba limitado a 1280x720 (o el tamaño de pantalla), 
pero el mundo puede ser de 5000x10000 píxeles. La cámara se movía pero el jugador 
quedaba confinado en una zona pequeña.

## SOLUCIÓN

Cambiar los límites del jugador para que se basen en los límites del mundo de la cámara,
no en el tamaño de la pantalla. Esto permite:

1. **Jugador** se mueve dentro de: 32px a (mundoAncho - 32 - anchoJugador)
2. **Cámara** se mueve dentro de: 0 a mundoAncho
3. Ambos respetan los límites pero el jugador tiene espacio para moverse

## PASO 1: Actualizar Camara2D.java

✓ YA HECHO - Tu Camara2D.java ya tiene:
- setLimitesMundo(float ancho, float alto)
- Validación de zoom
- aplicarLimites() que restringe la cámara

## PASO 2: Crear GestorDeMundoJuego.java

✓ CREADO - Nueva clase que centraliza:
- Cálculo de límites para el jugador
- Cálculo de posición de cámara
- Sincronización entre cámara y jugador

Úsala así:

```java
// En tu pantalla de juego
private GestorDeMundoJuego gestorMundo;
private static final float MUNDO_ANCHO = 5000;
private static final float MUNDO_ALTO = 10000;

@Override
public void mostrar() {
    gestorMundo = new GestorDeMundoJuego(
        MUNDO_ANCHO, 
        MUNDO_ALTO, 
        Juego.ANCHO_PANTALLA, 
        Juego.ALTO_PANTALLA
    );

    // Configurar cámara
    camara.setLimitesMundo(MUNDO_ANCHO, MUNDO_ALTO);
}
```

## PASO 3: Actualizar Jugador.java

✓ CREADO Jugador_Mejorado.java con:

```java
// Nuevas variables
private static final int MARGEN_SEGURIDAD = 32;
private float limiteMundoIzquierdo;
private float limiteMundoDerecho;
private float limiteMundoArriba;
private float limiteMundoAbajo;

// Nuevo método
public void configurarLimitesDelMundo(float mundoAncho, float mundoAlto) {
    limiteMundoIzquierdo = MARGEN_SEGURIDAD;
    limiteMundoArriba = MARGEN_SEGURIDAD;
    limiteMundoDerecho = mundoAncho - MARGEN_SEGURIDAD - ancho;
    limiteMundoAbajo = mundoAlto - MARGEN_SEGURIDAD - alto;
}

// Método para aplicar límites
private void aplicarLimitesDelMundo() {
    if (x < limiteMundoIzquierdo) {
        x = limiteMundoIzquierdo;
    } else if (x > limiteMundoDerecho) {
        x = limiteMundoDerecho;
    }

    if (y < limiteMundoArriba) {
        y = limiteMundoArriba;
    } else if (y > limiteMundoAbajo) {
        y = limiteMundoAbajo;
    }
}

// En actualizar()
@Override
public void actualizar(float delta) {
    if (vida > 0) {
        super.actualizar(delta);

        // Aplicar movimiento
        x += velocidadX / Juego.DELTA_A_PIXEL * delta;
        y += velocidadY / Juego.DELTA_A_PIXEL * delta;

        // Aplicar límites basados en el mundo
        aplicarLimitesDelMundo();

        // ... resto de lógica
    }
}
```

## PASO 4: Usar en tu Pantalla de Juego

```java
public class PantallaJuegoNivel1 extends Pantalla2D {

    private Jugador jugador;
    private static final float MUNDO_ANCHO = 5000;
    private static final float MUNDO_ALTO = 10000;

    @Override
    public void mostrar() {
        // 1. Configurar límites de la cámara
        camara.setLimitesMundo(MUNDO_ANCHO, MUNDO_ALTO);

        // 2. Crear el jugador
        jugador = new Jugador(this, texturaJugador, 100, 100, 32, 32);

        // 3. IMPORTANTE: Configurar los límites del mundo en el jugador
        jugador.configurarLimitesDelMundo(MUNDO_ANCHO, MUNDO_ALTO);

        // 4. Agregar a actores
        actores.add(jugador);

        // 5. Posicionar cámara inicial
        camara.moverA(MUNDO_ANCHO / 2, MUNDO_ALTO / 2);
    }

    @Override
    public void actualizar(float delta) {
        // Actualizar actores
        for (Actor actor : actores) {
            actor.actualizar(delta);
        }

        // Seguir al jugador con la cámara
        float jugadorCentroX = jugador.getX() + jugador.getAncho() / 2;
        float jugadorCentroY = jugador.getY() + jugador.getAlto() / 2;

        camara.seguirSuave(jugadorCentroX, jugadorCentroY, 0.1f);
    }

    @Override
    public void dibujar(Graficos pincel, float delta) {
        for (Actor actor : actores) {
            // Solo dibujar si es visible
            if (camara.esVisible(actor.getX(), actor.getY(), 
                                actor.getAncho(), actor.getAlto())) {
                actor.dibujar(pincel, delta);
            }
        }
    }
}
```

## DIAGRAMA DEL FLUJO DE LÍMITES

```
┌─────────────────────────────────────────────┐
│        MUNDO (5000 x 10000 píxeles)         │
│  ┌──────────────────────────────────────┐   │
│  │    Área de Juego (32px margen)       │   │
│  │  32────────────────────────── 4968  │   │
│  │  ┌─────────────────────────────────┐ │   │
│  │  │                                 │ │   │
│  │  │  ┌───────────┐ ← Cámara        │ │   │
│  │  │  │ 1280x720  │                 │ │   │
│  │  │  │ ┌─┐ ← Jugador              │ │   │
│  │  │  │ │J│ (con margen de 32px)   │ │   │
│  │  │  │ └─┘                        │ │   │
│  │  │  │  Cámara se mueve dentro    │ │   │
│  │  │  │  de estos límites ────────┐│ │   │
│  │  │  │                          ││ │   │
│  │  │  └───────────┘              ││ │   │
│  │  │                            ││ │   │
│  │  └─────────────────────────────┘ │   │
│  │  Límite inferior para jugador:  │   │
│  │  10000 - 32 - 32 = 9936         │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────────┘
```

## FLUJO DE EJECUCIÓN

### Fase 1: Inicialización (mostrar())
```
1. Crear GestorDeMundoJuego
2. Configurar camara.setLimitesMundo(5000, 10000)
3. Crear Jugador
4. Jugador.configurarLimitesDelMundo(5000, 10000)
5. Agregar jugador a actores
```

### Fase 2: Actualización (actualizar())
```
1. Jugador se mueve por entrada del usuario
2. aplicarLimitesDelMundo() restringe posición del jugador
3. Cámara sigue al jugador usando seguirSuave()
4. aplicarLimites() en cámara restringe su posición
5. Cámara dibuja el mundo dentro de su viewport
```

### Fase 3: Renderizado (dibujar())
```
1. Aplicar transformación de cámara al canvas
2. Para cada actor:
   a. Verificar si está en esVisible()
   b. Si es visible, dibujar
3. Resetear transformación
4. Dibujar UI estática (FPS, etc.)
```

## PARÁMETROS CONFIGURABLES

Puedes ajustar estos valores según necesites:

```java
// En Jugador.java
private static final int MARGEN_SEGURIDAD = 32;  // Distancia desde el borde

// En tu pantalla
private static final float MUNDO_ANCHO = 5000;    // Ancho del nivel
private static final float MUNDO_ALTO = 10000;    // Alto del nivel

// En Pantalla.actualizar()
camara.seguirSuave(jX, jY, 0.1f);  // 0.1f = suave, 1.0f = rígido
```

## DIFERENCIAS: ANTES vs DESPUÉS

### ANTES (Limitado a pantalla):
```
Jugador limitado a: [32, ANCHO_PANTALLA-32] × [32, ALTO_PANTALLA-32]
                    [32, 1248] × [32, 688]
Mundo real: 5000 × 10000
Resultado: Jugador confinado en zona pequeña
```

### DESPUÉS (Limitado a mundo):
```
Jugador limitado a: [32, MUNDO_ANCHO-32-anchoJugador] × [32, MUNDO_ALTO-32-altoJugador]
                    [32, 4968] × [32, 9968]
Mundo real: 5000 × 10000
Cámara limitada a: [640, 4360] × [360, 9640]
Resultado: Jugador puede explorar todo el mundo con seguridad
```

## CHECKLIST DE IMPLEMENTACIÓN

- [ ] Copiar Jugador_Mejorado.java → Jugador.java
- [ ] Copiar GestorDeMundoJuego.java a tu proyecto
- [ ] En tu PantallaJuego:
  - [ ] Crear instancia de GestorDeMundoJuego
  - [ ] Llamar camara.setLimitesMundo()
  - [ ] Llamar jugador.configurarLimitesDelMundo()
  - [ ] Implementar cálculo de cámara con seguirSuave()
- [ ] Probar en un dispositivo:
  - [ ] El jugador se mueve correctamente
  - [ ] El jugador respeta los límites del mundo
  - [ ] La cámara sigue suavemente
  - [ ] La cámara no sale del mundo
  - [ ] No hay artefactos visuales

## OPTIMIZACIONES ADICIONALES (Opcional)

### Usar GestorDeMundoJuego para validar posiciones:
```java
float[] posCamara = gestorMundo.calcularPosicionCamara(
    jugador.getCentroX(),
    jugador.getCentroY(),
    Juego.ANCHO_PANTALLA,
    Juego.ALTO_PANTALLA
);
camara.moverA(posCamara[0], posCamara[1]);
```

### Sistema de niveles con diferentes tamaños:
```java
public class ManagerDeNiveles {
    static final float[][] TAMANOS = {
        {5000, 10000},   // Nivel 1
        {8000, 12000},   // Nivel 2
        {10000, 15000},  // Nivel 3
    };
}
```

## PROBLEMAS COMUNES Y SOLUCIONES

**P: El jugador sigue saliendo del mundo**
R: Verifica que llamaste a jugador.configurarLimitesDelMundo()

**P: La cámara se mueve de forma rígida**
R: Ajusta el parámetro de seguirSuave() a un valor mayor (0.05f a 0.2f)

**P: El jugador se congela en los bordes**
R: Asegúrate de que los límites son correctos en aplicarLimitesDelMundo()

**P: Se ve bien pero el movimiento no es suave**
R: Aumenta la duración del tween/interpolación en la cámara

## PRÓXIMOS PASOS

1. Implementar diferentes mundos/niveles con diferentes tamaños
2. Sistema de portales/puertas que cambian el mundo
3. Múltiples jugadores con límites sincronizados
4. Sistema de enemigos con límites de mundo
5. Objetos coleccionables con respeto a límites

---

**Nota**: Esta solución es escalable y puede adaptarse a:
- Múltiples jugadores
- Diferentes tipos de actores
- Sistema de físicas
- Cámaras con zoom dinámico
